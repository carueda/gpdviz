[![Build Status](https://travis-ci.org/gpdviz/gpdviz.svg?branch=master)](https://travis-ci.org/gpdviz/gpdviz)

# Gpdviz

Gpdviz is a tool for web-based visualization of geo-located point data streams in real-time.

Gpdviz uses a simple data model and a REST API for data providers to register sensor systems,
data streams, and observations.
This API is specified using [OpenAPI 2.0](https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md).
The visualization is updated in real-time using WebSockets.

Assuming Gpdviz is deployed at `http://example.net/gpdviz` and particular sensor system with 
ID `mysysid`:
- Data provider uses the REST API endpoint at `http://example.net/gpdviz/api`.
  A page with the complete API documentation, with ability to directly exercise it (powered by Swagger UI),
  is located at `http://example.net/gpdviz/api-docs`.
- Users visualize the system at `http://example.net/gpdviz/mysysid/`

**Motivation** 

Gpdviz is motivated by the value of having a web-based, lightweight tool for easy
visualization of sensor data information especially in non-data intensive scenarios.
It is intended to complement the available tool set for the user.


**Data model**

Gpdviz's data model is intended to be simple.
There are three main entities in the data model:
_sensor systems_, _data streams_, and _observations_.

- A sensor system has associated metadata (name, description, etc.) 
  and consists of a set of data streams.

- A data stream has associated metadata (name, description, map/chart styles, etc.) 
  and consists of a set of variable definitions and associated timestamped data observations.

- A variable definition consists of a name, units, and chart style. 

- An observation is timestamped and can capture scalar data (eg., temperature values),
  as well as features and geometries (in geo-json format).
 
**Operations for data providers**

Data providers interact with a Gpdviz endpoint to perform the following operations:

- Register/unregister sensor systems
- Add/remove data streams
- Register data stream observations

The Gpdviz server maintains a registry with the provided information for each sensor system
including a window of most recent reported observations for each stream in the system.
Users will be able to see the latest reported state whenever they open the particular
URL corresponding to the desired sensor system, and in real time see any subsequent
updates reported by the provider.


## Running

Download the latest executable JAR `gpdviz-x.y.z.jar` from https://github.com/gpdviz/gpdviz/releases/.

To execute Gpdviz you will need a [Java runtime environment](https://www.java.com/) and
access to a PostgreSQL server. 

- Gpdviz expects a number of parameters for its regular execution. These parameters are to be
  indicated in a local `gpdviz.conf` file on the current directory. A template of such file, with
  a description of the various parameters, can be generated as follows:

        $ java -jar gpdviz-x.y.z.jar generate-conf

- Edit `gpdviz.conf` as indicated.

- Create the database according to the relevant parameters in `gpdviz.conf`, e.g.:

        $ psql -c 'create database gpdviz;' -U postgres

- Execute the Gpdviz server: 

        $ java -jar gpdviz-x.y.z.jar run-server


This [bash script](https://github.com/gpdviz/gpdviz/blob/master/data/ss1.demo.sh)
can be used as a demo of a data provider. Define the `GPDVIZ_SERVER` environment
variable prior to running this [httpie](https://httpie.org/)-based script.

For a similar demo in Python, see https://github.com/gpdviz/gpdviz_python_client_example.

## Development

Gpdviz implementation is based on:

- [Akka-HTTP](http://doc.akka.io/docs/akka-http/current/scala/http/)
- [ScalaJS](https://www.scala-js.org/)
- [Leaflet](http://leafletjs.com/)
- [Highcharts](http://www.highcharts.com/)


### build and run

    $ npm install jsdom source-map-support
	$ sbt
	> package   # to copy js resources to jvm's classpath needed for the webapp
	> gpdvizJVM/runMain gpdviz.Gpdviz generate-conf
	> gpdvizJVM/runMain gpdviz.Gpdviz create-tables
	> gpdvizJVM/runMain gpdviz.Gpdviz add-some-data
	> gpdvizJVM/runMain gpdviz.Gpdviz run-server

Open http://localhost:5050/ss1/

On another terminal (this requires [httpie](https://httpie.org/)):

	$ data/ss1.demo.sh


![](https://github.com/gpdviz/gpdviz/blob/master/static/gpdviz2.gif)


### Dist

	$ sbt gpdvizJVM/assembly

generates: `jvm/target/scala-2.12/gpdviz-assembly-x.y.z.jar`.

### Model

Data model details are still wip.

### API

OpenAPI spec generated by [swagger-akka-http](https://github.com/swagger-akka-http/swagger-akka-http).
 
**Swagger UI**

A Swagger UI instance is embedded as follows:

- copy [Swagger UI dist/*](https://github.com/swagger-api/swagger-ui/tree/master/dist) 
  contents to `jvm/src/main/resources/swaggerui/`;
- adjust the `url` entry in `swaggerui/index.html` to refer to the generated spec:
  `url: window.location + "/swagger.json"`
- rebuild

Under local development:
- generated spec at http://localhost:5050/api-docs/swagger.json
- Swagger UI at http://localhost:5050/api-docs



## history

[Original idea](https://github.com/carueda/gpdviz0).
