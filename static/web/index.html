<!DOCTYPE html>
<html ng-app="gpdviz" ng-controller="GpdvizController as vm">
<head>
  <title>#sysid - Gpdviz</title>
  <link rel="stylesheet" href="//unpkg.com/leaflet@1.0.0-rc.3/dist/leaflet.css" />
  <link rel="stylesheet" href="leaflet/Leaflet.MousePosition/src/L.Control.MousePosition.css" />
  <link rel="stylesheet" href="leaflet/Leaflet.MagnifyingGlass/leaflet.magnifyingglass.css" />
  <link rel="stylesheet" href="app.css" />
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.4.7/angular.js"></script>
  <script src="//cdn.jsdelivr.net/lodash/4.15.0/lodash.min.js"></script>
  <script src="//cdn.jsdelivr.net/momentjs/2.15.1/moment.min.js"></script>
  <script src="//js.pusher.com/3.2/pusher.min.js"></script>
  <script src="//unpkg.com/leaflet@1.0.0-rc.3/dist/leaflet.js"></script>
  <script src="//cdn-geoweb.s3.amazonaws.com/esri-leaflet/1.0.0-rc.2/esri-leaflet.js"></script>
  <script src="leaflet/Leaflet.MousePosition/src/L.Control.MousePosition.js"></script>
  <script src="leaflet/Leaflet.MagnifyingGlass/leaflet.magnifyingglass.js"></script>
  <script src="//code.highcharts.com/stock/highstock.js"></script>
  <script src="//code.highcharts.com/stock/highcharts-more.js"></script>
  <script src="//code.highcharts.com/stock/modules/exporting.js"></script>

  <script type="text/javascript" src="app.js"></script>
  <script>
    var Gpdviz = { "initialSs": #ssVar };
    //Pusher.logToConsole = true; // don't include this in production
    var pusher = new Pusher('#pusherKey', { encrypted: true });
    var channel = pusher.subscribe('#pusherChannel');
  </script>
  <style>
    body { margin: 5px 10px; }
  </style>
</head>
<body>
  <div style="text-align: center; background-color: #ebfaf5">
    <span style="font-weight: bold">
      <code>#sysid</code> - <span ng-bind="vm.ss.name"></span>
    </span>
    <span ng-bind="vm.ss.description"></span>
  </div>
  <table style="width: 100%">
    <tbody>
    <tr>
      <td style="width: 300px; vertical-align: top">
        <div ng-if="vm.ss">
          <div ng-if="vm.ss.streams">
            #sysid streams:
            <ul>
              <li ng-repeat="(strid, str) in vm.ss.streams">
                <div>
                  <span style="font-weight:bold" ng-bind="strid"></span>
                  <span ng-if="str.name" ng-bind="'name: ' + str.name"></span>
                  <span ng-if="str.description" ng-bind="'description: ' + str.description"></span>
                </div>
                <div ng-bind="'Obs: ' + str.obs.length"></div>
                <!--ul>
                  <li ng-repeat="obs in str.obs">
                    <span ng-bind="obs.timestamp + ': ' + (obs.chartTsData|json)"></span>
                  </li>
                </ul-->
              </li>
            </ul>
          </div>
        </div>
        <div ng-if="!vm.ss">
          <span style="color: brown">
            Waiting for registration event...
          </span>
        </div>
      </td>
      <td style="vertical-align: top">
        <div id="mapid" style="height:1300px"></div>
      </td>
    </tr>
    </tbody>
  </table>

  <div ng-if="vm.debug">
    <br>vm:<pre ng-bind="vm | json"></pre>
  </div>
</body>
</html>
